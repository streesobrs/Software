<Window x:Class="Software.其他窗口.WindowUpdate"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:Software.其他窗口"
        Title="WindowUpdate" 
        Height="480" Width="800" 
        Background="#E0F7FA"
        MinWidth="750" MinHeight="350">
    <Window.Resources>
        <local:ProgressBarWidthConverter x:Key="ProgressBarWidthConverter"/>
    </Window.Resources>
    <!-- 根 Grid：控制整体布局 -->
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <!-- 上半部分：版本+说明（占满垂直空间） -->
            <RowDefinition Height="Auto"/>
            <!-- 下半部分：进度+按钮（自适应高度） -->
        </Grid.RowDefinitions>

        <!-- ************ 上半部分：版本信息 + 更新说明（左右分栏） ************ -->
        <Grid Grid.Row="0" x:Name="TopGrid">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="3*"/>
                <!-- 左侧版本区：占3份 -->
                <ColumnDefinition Width="1"/>
                <!-- 分隔线（可选，视觉分隔） -->
                <ColumnDefinition Width="4*"/>
                <!-- 右侧说明区：占4份 -->
            </Grid.ColumnDefinitions>

            <!-- 左侧：版本信息容器 -->
            <Border Grid.Column="0" Margin="10">
                <StackPanel>
                    <TextBlock Text="有可用更新" FontSize="18" FontWeight="Bold" 
                               Foreground="#0277BD" Margin="0 0 0 15"/>
                    <!-- 版本信息行 -->
                    <StackPanel Orientation="Horizontal" Margin="0 0 0 5">
                        <TextBlock Text="当前版本:" Foreground="#0277BD" FontWeight="Bold" Width="80"/>
                        <TextBlock x:Name="CurrentVersion" Foreground="#0277BD"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0 0 0 5">
                        <TextBlock Text="更新版本:" Foreground="#0277BD" FontWeight="Bold" Width="80"/>
                        <TextBlock x:Name="VersionInfo" Foreground="#0277BD"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0 0 0 5">
                        <TextBlock Text="下载大小:" Foreground="#0277BD" FontWeight="Bold" Width="80"/>
                        <TextBlock x:Name="DownloadSize" Foreground="#0277BD"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0 0 0 15">
                        <TextBlock Text="上次更新时间:" Foreground="#0277BD" FontWeight="Bold" Width="100"/>
                        <TextBlock x:Name="LastUpdate" Foreground="#0277BD"/>
                    </StackPanel>

                    <!-- 更新方式选择 -->
                    <TextBlock Text="选择更新方式:" FontSize="14" Foreground="#0277BD" 
                               FontWeight="Bold" Margin="0 0 0 5"/>
                    <ComboBox x:Name="UpdateModeComboBox" 
                              Foreground="#0277BD" 
                              SelectionChanged="UpdateModeComboBox_SelectionChanged"
                              Margin="0 0 0 15"/>

                    <StackPanel Orientation="Horizontal" Margin="10,5,0,0" VerticalAlignment="Center">
                        <CheckBox x:Name="DeletePackageAfterUpdate" 
                                            Foreground="#0277BD" 
                                            Content="更新完成后删除安装包" 
                                            IsChecked="True"/>
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- 分隔线（可选，增强视觉） -->
            <Border Grid.Column="1" Background="#B3E5FC" Width="1" Margin="5 0"/>

            <!-- 右侧：更新说明容器 -->
            <Border Grid.Column="2" Margin="10">
                <StackPanel>
                    <TextBlock Text="更新说明" FontSize="18" FontWeight="Bold" 
                               Foreground="#0277BD" Margin="0 0 0 10"/>
                    <ScrollViewer VerticalScrollBarVisibility="Auto" Height="200">
                        <TextBlock x:Name="ReleaseNotes" Text="更新日志" 
                                   TextWrapping="Wrap" Foreground="#0277BD"/>
                    </ScrollViewer>
                </StackPanel>
            </Border>
        </Grid>

        <!-- ************ 下半部分：进度条 + 状态 + 按钮 ************ -->
        <Grid Grid.Row="1" Margin="10">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <!-- 阶段描述行 -->
                <RowDefinition Height="Auto"/>
                <!-- 主进度条行 -->
                <RowDefinition Height="Auto"/>
                <!-- 子进度条行 -->
                <RowDefinition Height="Auto"/>
                <!-- 状态信息行 -->
                <RowDefinition Height="Auto"/>
                <!-- 按钮行 -->
            </Grid.RowDefinitions>

            <!-- 阶段描述文本 -->
            <TextBlock Grid.Row="0" x:Name="StageDescriptionText" 
                       Text="当前阶段: 检查更新" 
                       FontSize="14" FontWeight="Bold" 
                       Foreground="#0277BD" Margin="0 5 0 0"/>

            <!-- 主进度条区域 -->
            <Grid Grid.Row="1" Margin="0 5 0 0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="60"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="50"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0" Text="主进度:" FontSize="14" FontWeight="Bold" 
                           Foreground="#0277BD" VerticalAlignment="Center"/>
                <ProgressBar Grid.Column="1" x:Name="MainProgressBar" Height="25" 
                             Value="0" Maximum="100" 
                             Foreground="#0277BD" Background="#B3E5FC"/>
                <TextBlock Grid.Column="2" x:Name="MainProgressPercentage" Text="0%" 
                           FontSize="14" Foreground="#0277BD" FontWeight="Bold" 
                           VerticalAlignment="Center"/>
            </Grid>

            <!-- 子进度条区域 -->
            <Grid Grid.Row="2" Margin="0 5 0 0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="60"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="50"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0" Text="子进度:" FontSize="14" FontWeight="Bold" 
                           Foreground="#0277BD" VerticalAlignment="Center"/>
                <ProgressBar Grid.Column="1" x:Name="SubProgressBar" Height="25" 
                             Value="0" Maximum="100" 
                             Foreground="#0277BD" Background="#B3E5FC"/>
                <TextBlock Grid.Column="2" x:Name="SubProgressPercentage" Text="0%" 
                           FontSize="14" Foreground="#0277BD" FontWeight="Bold" 
                           VerticalAlignment="Center"/>
            </Grid>

            <!-- 状态信息区域 -->
            <StackPanel Grid.Row="3" Orientation="Horizontal" Margin="0 5 0 5" HorizontalAlignment="Left">
                <TextBlock x:Name="DownloadProgress" Text="0 MB / 0 MB" 
                           FontSize="14" Foreground="#0277BD" FontWeight="Bold" Width="140"/>
                <TextBlock x:Name="DownloadSpeed" Text="下载速度: 0 MB/s" 
                           FontSize="14" Foreground="#0277BD" FontWeight="Bold" Width="140"/>
                <TextBlock x:Name="StatusTextBlock" Text="状态: 等待中..." 
                           FontSize="14" Foreground="#0277BD" FontWeight="Bold"/>
            </StackPanel>

            <!-- 按钮区域 -->
            <StackPanel Grid.Row="4" Orientation="Horizontal" HorizontalAlignment="Right">
                <Button Content="更新" Width="100" Height="35" Margin="0 0 10 0" 
                        Click="StartUpdate_Click" 
                        Foreground="White" Background="#0288D1" FontWeight="Bold"/>
                <Button Content="关闭" Width="100" Height="35" 
                        Click="Close_Click" 
                        Foreground="White" Background="#0288D1" FontWeight="Bold"/>
            </StackPanel>
        </Grid>
    </Grid>
</Window>